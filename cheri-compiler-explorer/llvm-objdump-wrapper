#!/bin/bash

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"

ARGS=()

# Strip GNU-only --insn-width and turn GNU -M intel into --x86-asm-syntax=intel
while [ $# -gt 0 ]; do
	case "$1" in
	--insn-width=*)
		shift
		continue
		;;
	--insn-width)
		shift; shift
		continue
		;;
	-M)
		if [ $# -gt 1 ] && [ "$2" = "intel" ]; then
			ARGS+=("--x86-asm-syntax=intel")
			shift; shift
			continue
		fi
		;;
	-Mintel)
		ARGS+=("--x86-asm-syntax=intel")
		shift
		continue
		;;
	esac
	ARGS+=("$1")
	shift
done

exec "$DIR/llvm-objdump" "${ARGS[@]}"
